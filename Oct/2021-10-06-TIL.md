## **Django**

<br>

##  **âœ” ì˜¤ëŠ˜ ë°°ìš°ê³  ì •ë¦¬í•œ ëª©ì°¨**
1. Relationship fields(ForeignKey)

2. django custom template filter

3. django.contrib.humanize - ì‚¬ëŒì´ ì½ê¸° ì¢‹ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.

<br>

<br>

## ğŸ” ***Relationship fields***

<br>

### â—† ***ForeignKey***
ForeignkeyëŠ” ë‹¤ëŒ€ì¼ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ê³  ê¸°ë³¸ í˜•íƒœëŠ” `Foreignkey(to, on_delete, **options)`ì´ë‹¤.

ì¬ê·€ì  ê´€ê³„(ìì‹ê³¼ ë‹¤ëŒ€ì¼ ê´€ê³„ê°€ ìˆëŠ” ê°ì²´)ë¥¼ ë§Œë“¤ë ¤ë©´ 

`models.ForeignKey('self', on_delete=models.CASCADE)`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. â†’ 21.10.04TIL

ì•„ì§ ì •ì˜ë˜ì§€ ì•Šì€ ëª¨ë¸ì— ëŒ€í•œ ê´€ê³„ë¥¼ ìƒì„±í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ëª¨ë¸ ê°ì²´ ìì²´ê°€ ì•„ë‹Œ 

'ëª¨ë¸ ì´ë¦„'ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´
```python
from django.db import models

class Car(models.Model):
    manufacturer = models.ForeignKey(
        'Manufacturer',
        on_delete=models.CASCADE,
    )
    # ...

class Manufacturer(models.Model):
    # ...
    pass
```

abstract modelì—ì„œ ì •ì˜ëœ ê´€ê³„ë“¤ì€ ëª¨ë¸ì´ êµ¬ì²´ì ì¸ ëª¨ë¸ë¡œ ë¶„ë¥˜ë˜ê±°ë‚˜ í˜¹ì€ 

abdtract modelì˜ app_labelê³¼ ê´€ë ¨ì´ ì—†ì„ë•Œ í™•ê³ í•´ì§‘ë‹ˆë‹¤.

```python
# products/models.py
from django.db import models

class AbstractCar(models.Model):
    manufacturer = models.ForeignKey('Manufacturer', on_delete=models.CASCADE)

    class Meta:
        abstract = True

#production/models.py
from django.db import models
from products.models import AbstractCar

class Manufacturer(models.Model):
    pass

class Car(AbstractCar):
    pass
```
ë‹¤ë¥¸ APPì—ì„œ ì •ì˜ëœ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ëœë‹¤.
```python
class Car(models.Model):
    manufacturer = models.ForeignKey(
        'production.Manufacturer',
        on_delete=models.CASCADE,
    )
```
ì´ëŸ¬í•œ ì°¸ì¡°ë¥¼ `lazy relationship`ì´ë¼ê³  í•˜ëŠ”ë°, ë‘ APPê°„ì˜ `circular import error`ë¥¼

í•´ê²°í•˜ëŠ”ë° ìœ ìš©í•©ë‹ˆë‹¤.

<br>

DB INDEXëŠ” ForeignKeyì— ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ìëŠ” ì¸ë±ìŠ¤ ì˜¤ë²„í—¤ë“œë¥¼ 

í”¼í•˜ê³  ì‹¶ì„ ìˆ˜ë„(=ìë™ ìƒì„±ì„ í”¼í•˜ê³  ì‹¶ì„ ìˆ˜ë„) ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Joinì˜ ëª©ì ì´ 

ì•„ë‹Œ ì¼ê´€ì„±ì„ ìœ„í•´ ì™¸ë˜í‚¤ë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš° í˜¹ì€, 'partial or multiple column index'ì™€ 

ê°™ì€ 'ëŒ€ì²´index'ë¥¼ ìƒì„±í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” `db_index = False` ëª…ë ¹ì–´ë¡œ ìë™ìƒì„±ì„ 

ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

---

<br>

<br>

### â—† ***Database Representation***
DjangoëŠ” ì‚¬ìš©ì ëª°ë˜ ë’¤ì—ì„œ í•„ë“œ ì´ë¦„ì— "_id"ë¥¼ ì¶”ê°€í•˜ì—¬ DB ì—´ì˜ ì´ë¦„ì„ ë§Œë“­ë‹ˆë‹¤.

ìœ„ì˜ ì˜ˆì—ì„œ Car ëª¨ë¸ì— ëŒ€í•œ DB í…Œì´ë¸”ì—ëŠ” manufacturer_id ì—´ì´ ìƒì„±ë˜ì–´ ì§‘ë‹ˆë‹¤.

ë¬¼ë¡  ê°œë°œìê°€ db_columnì„ ì§€ì •í•˜ì—¬ ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ 

ì‚¬ìš©ì ì •ì˜ SQLì„ ì‘ì„±í•˜ì§€ ì•ŠëŠ” í•œ ì½”ë“œëŠ” DB ì—´ ì´ë¦„ì— ëŒ€í•œ ì²˜ë¦¬ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

ì™œëƒë©´ í•­ìƒ ëª¨ë¸ ê°ì²´ì˜ í•„ë“œ ì´ë¦„ìœ¼ë¡œ DB ì—´ì˜ ì´ë¦„ì„ ì§€ì •í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

---

<br>

<br>

### â—† ***on_delete***

ForeignKeyëŠ” 'ê´€ê³„ ì‘ë™ ë°©ì‹'ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì •ì˜í•˜ëŠ” ë‹¤ë¥¸ ì¸ìˆ˜ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

ForeignKeyê°€ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ì‚­ì œë  ë•Œ, DjangoëŠ” on_delete ì¸ìˆ˜ë¡œ ì§€ì •ëœ SQL ì œì•½ 

ì¡°ê±´ì˜ ë™ì‘ì„ ë˜‘ê°™ì´ ë”°ë¼í•©ë‹ˆë‹¤. `on_delete`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— SQL ì œì•½ ì¡°ê±´ì„ ìƒì„±

í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `on_delete`ì— ë„£ì„ ìˆ˜ ìˆëŠ” ê°’ì€ <span style="color:green">**django.db.models**</span> ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.
```
1) CASCADE

ê³„ë‹¨ì‹ ì‚­ì œ. ForeignKeyë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ë„ ì‚­ì œí•©ë‹ˆë‹¤.


2) PROTECT

django.db.IntegrityErrorì˜ í•˜ìœ„ í´ë˜ìŠ¤ì¸ ProtectedErrorë¥¼ ë°œìƒì‹œì¼œ 

ì°¸ì¡°ëœ ê°œì²´ì˜ ì‚­ì œë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.


3) RESTRICT (New in Django 3.1)

RestrictedError(django.db.IntegrityErrorì˜ í•˜ìœ„ í´ë˜ìŠ¤)ë¥¼ ë°œìƒì‹œì¼œ ì°¸ì¡°ëœ ê°œì²´ì˜ 

ì‚­ì œë¥¼ ë°©ì§€í•©ë‹ˆë‹¤. PROTECTì™€ ë‹¬ë¦¬ CASCADE ê´€ê³„ë¥¼ í†µí•´ ë™ì¼í•œ ì‘ì—…ì—ì„œ ì‚­ì œë˜ëŠ”

ë‹¤ë¥¸ ê°œì²´ë„ ì°¸ì¡°í•˜ëŠ” ê²½ìš° ì°¸ì¡°ëœ ê°œì²´ì˜ ì‚­ì œê°€ í—ˆìš©ë©ë‹ˆë‹¤.


4) SET_NULL

ForeignKey nullì„ ì„¤ì •í•˜ì‹­ì‹œì˜¤. ì´ê²ƒì€ nullì´ Trueì¸ ê²½ìš°ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.


5) SET_DEFAULT

ForeignKeyë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ForeignKeyì˜ ê¸°ë³¸ê°’ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
```
ì´ ì™¸ì—ë„ ë” ìˆìœ¼ë‹ˆ Django Documentsë¥¼ ë´ì•¼í•œë‹¤.

---

<br>

<br>

### â—† ***related_name***
models.pyë¥¼ migrateí•˜ëŠ” ê³¼ì •ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë‚˜íƒ€ë‚¬ë‹¤.
![image](https://user-images.githubusercontent.com/83274792/136161576-f131eaca-caa1-4400-a357-1f99c613f84e.png)
ì—ëŸ¬ ë©”ì„¸ì§€ì—ì„œëŠ” instagra.Post.author ì™€ like_user_setì˜ `reverse name`ì´ ì¶©ëŒí–ˆìœ¼ë‹ˆ 

ìˆ˜ì •í•˜ë¼ê³  í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰, ForeignKeyì—ì„œ `"ëª¨ë¸ëª…_set"`ì´ ê²¹ì³ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ëŠ” ëœ».

ë”°ë¼ì„œ djangoì—ì„œì˜ 'ForeignKey.related_name'ì— ëŒ€í•´ì„œ ìì„¸íˆ ê³µë¶€í•˜ê¸°ë¡œ í–ˆë‹¤.

Django Documentsë¥¼ ì½ì–´ë³´ë‹ˆ <span style="color:green">**Following relationships â€œbackwardâ€**</span>ì„ ì½ì–´ë³´ë¼ê³  í–ˆë‹¤.


ì•„ë¬´íŠ¼, `related_name`ì€ ê´€ë ¨ ê°ì²´ì—ì„œ ë‹¤ì‹œ ì´ ê°ì²´ë¡œì˜ ê´€ê³„ì— ì‚¬ìš©í•  ì´ë¦„ì´ë‹¤. 

ë˜í•œ related_query_name(ëŒ€ìƒì˜ ì—­ í•„í„° ì´ë¦„ì— ì‚¬ìš©í•  ì´ë¦„)ì˜ ê¸°ë³¸ê°’ì´ê¸°ë„ í•˜ë‹¤. 

Djangoê°€ ì—­ë°©í–¥ ê´€ê³„ë¥¼ ìƒì„±í•˜ì§€ ì•Šë„ë¡ í•˜ë ¤ë©´ related_nameì„ '+'ë¡œ ì„¤ì •í•˜ê±°ë‚˜ 

'+'ë¡œ ëëƒ…ë‹ˆë‹¤.
```python
user = models.ForeignKey(
    User,
    on_delete=models.CASCADE,
    related_name='+',
)
```
---

<br>

<br>

### â—† ***Following relationships â€œbackwardâ€***
ë§Œì•½ ëª¨ë¸ì´ <span style="color:green">**ForeignKey**</span>ë¥¼ ê°–ê³  ìˆë‹¤ë©´, ì™¸ë˜ í‚¤ ëª¨ë¸ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” ì²« ë²ˆì§¸ ëª¨ë¸ì˜ ëª¨ë“  

ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” `Manager`ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  ê¸°ë³¸ì ìœ¼ë¡œ ì´ Managerì˜ ì´ë¦„ì€

post_setì´ë©° ì—¬ê¸°ì„œ postëŠ” ëª¨ë¸ ì´ë¦„ì´ë©° ì†Œë¬¸ìë¡œ í‘œê¸°í•©ë‹ˆë‹¤. ì´ ManagerëŠ” ìœ„ì˜

["Retrieving objects"](https://docs.djangoproject.com/en/3.2/topics/db/queries/#related-objects) ì„¹ì…˜ì— ì„¤ëª…ëœ ëŒ€ë¡œ í•„í„°ë§ ë° ì¡°ì‘í•  ìˆ˜ ìˆëŠ” QuerySetì„ ë°˜í™˜í•©ë‹ˆë‹¤. 

ì ê¹ Retrieving objectsì— ëŒ€í•´ì„œ ì •ë¦¬í•´ë³´ìë©´,

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ Retrieving objects(ê°œì²´ë¥¼ ê²€ìƒ‰)í•˜ë ¤ë©´ ëª¨ë¸ í´ë˜ìŠ¤ì—ì„œ Managerë¥¼ í†µí•´ 

QuerySetì„ êµ¬ì„±í•©ë‹ˆë‹¤. SQL ìš©ì–´ë¡œ QuerySetì€ SELECT ë¬¸ì— í•´ë‹¹í•˜ê³  í•„í„°ëŠ” WHERE 

ë˜ëŠ” LIMITì™€ ê°™ì€ ì œí•œ ì ˆì…ë‹ˆë‹¤. ëª¨ë¸ì˜ Managerë¥¼ ì‚¬ìš©í•˜ì—¬ QuerySetì„ ì–»ê³ , 

ê° ëª¨ë¸ì—ëŠ” í•˜ë‚˜ ì´ìƒì˜ Managerê°€ ìˆìœ¼ë©° ê¸°ë³¸ì ìœ¼ë¡œ `objects`ë¼ê³  í•©ë‹ˆë‹¤.

ê²°êµ­ ì—ëŸ¬ì˜ ì›ì¸ì€ post.authorì™€ post.like_user_setì˜ managerê°€ `post_set`ìœ¼ë¡œ 

ë™ì¼í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•œ ë¬¸ì œì˜€ë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ related_nameì„ ë°”ê¿”ì£¼ì—ˆë‹¤.
```python
class Post(models.Model):
    author = models.ForeignKey(
                                settings.AUTH_USER_MODEL,
                                on_delete=CASCADE,
                                related_name="my_post_set"
                                )  

    like_user_set = models.ManyToManyField(
                                settings.AUTH_USER_MODEL,
                                blank=True
                                related_name="like_post_set",
                                )
```
---

<br>

<br>

## ğŸ” ***Django custom template filter***
Djangoì˜ í…œí”Œë¦¿ ì–¸ì–´ì—ëŠ” APPì˜ presentation logic needsì„ í•´ê²°í•˜ë„ë¡ ì„¤ê³„ëœ ë‹¤ì–‘í•œ 

ë‚´ì¥ íƒœê·¸ ë° í•„í„°ê°€ í•¨ê»˜ ì œê³µë©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  í…œí”Œë¦¿ ê¸°ë³¸ ìš”ì†Œì˜ í•µì‹¬ ì§‘í•©ì—ì„œ

ë‹¤ë£¨ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Pythonì„ ì‚¬ìš©í•˜ì—¬ custom tagsì™€ í•„í„°ë¥¼ ì •ì˜í•˜ì—¬ 

í…œí”Œë¦¿ ì—”ì§„ì„ í™•ì¥í•œ ë‹¤ìŒ {% load %} íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ 

ìˆìŠµë‹ˆë‹¤. ë””ë ‰í† ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ì´ `templatetags`ì•ˆì— íŒŒì¼ì„ ìƒì„±í•´ì£¼ë©´ ëœë‹¤.
```markdown
polls/
    __init__.py
    models.py
    templatetags/
        __init__.py
        poll_extras.py
    views.py
```
ìœ íš¨í•œ íƒœê·¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë˜ë ¤ë©´ ëª¨ë“ˆì— ëª¨ë“  íƒœê·¸ì™€ í•„í„°ê°€ ë“±ë¡ë˜ëŠ” `template.Libray`ì˜ 

ì¸ìŠ¤í„´ìŠ¤ì¸ `register`ë¼ëŠ” ëª¨ë“ˆ ë³€ìˆ˜ê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤. ì•„ë˜ëŠ” ì˜ˆì‹œ.
```python
# instagram_tags.py

from django import template

register = template.Library()

@register.filter
def is_like_user(post, user):
    return post.is_like_user(user)
```
ê°œë°œìê°€ í…œí”Œë¦¿ í•„í„°ë¥¼ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° í•„í„°ëŠ” í•˜ë‚˜ í˜¹ì€ ë‘ ê°œì˜ ì¸ìˆ˜ë¥¼

ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” pythoní•¨ìˆ˜ ì…ë‹ˆë‹¤.
```markdown
1) ë³€ìˆ˜ ê°’(ì…ë ¥) â€“ ë°˜ë“œì‹œ ë¬¸ìì—´ì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

2) ì¸ìˆ˜ì˜ ê°’ â€“ ê¸°ë³¸ê°’ì„ ê°€ì§ˆ ìˆ˜ë„ ìˆê³  ì•„ì˜ˆ ìƒëµí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```
ì˜ˆë¥¼ ë“¤ì–´, {{ var|foo:"bar" }}ì—ì„œ í•„í„° fooëŠ” "ë³€ìˆ˜ var"ì™€ "ì¸ìˆ˜ bar"ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

---

<br>

<br>

## ğŸ” ***django.contrib.humanize***

<br>

ì´ í•„í„°ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ INSTALLED_APPS ì„¤ì •ì— 'django.contrib.humanize'ë¥¼ 

ì¶”ê°€í•˜ì„¸ìš”. ì´ ì‘ì—…ì„ ì™„ë£Œí•œ í›„ í…œí”Œë¦¿ì—ì„œ {% load humanize %}ë¥¼ ì‚¬ìš©í•˜ë©´

ë‹¤ìŒ í•„í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

<br>

<br>

## ğŸ“ŒSummary
ì˜¤ëŠ˜ì€ Relational Fields ì¤‘ `ForeginKey`ì— ëŒ€í•´ ìì„¸íˆ ì•Œê²Œ ëë‹¤. 

ì¶”ê°€ ì ì¸ ë‚´ìš©ì¸ ë‹¤ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ì—ì„œë„ ì¶”ê°€ì ì¸ ê³µë¶€ë¥¼ í•´ì•¼í•œë‹¤.

ê·¸ë¦¬ê³  í•„í„°ëŠ” ì†”ì§íˆ ì´í•´ê°€ ì™„ë³€íˆ ë˜ì§„ ì•Šì•˜ë‹¤. ìš°ì„  ì´ëŸ°ê²Œ ìˆê³ , 

ì–¸ì œ, ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ì •ë„ëŠ” ìˆ™ì§€í•˜ê³  ìˆì–´ì•¼ê² ë‹¤.

---

<br>

<br>

## ğŸ’»References
- [Rrelated-Objects](https://docs.djangoproject.com/en/3.2/topics/db/queries/#related-objects)
- [Foreignkey](https://docs.djangoproject.com/en/3.2/ref/models/fields/#foreignkey)
- [Abstract-Base-Classes](https://docs.djangoproject.com/en/3.2/topics/db/models/#abstract-base-classes)
- [Custom template tags and filters](https://docs.djangoproject.com/en/3.2/howto/custom-template-tags/)
- [humanize](https://docs.djangoproject.com/en/3.2/ref/contrib/humanize/)

---